syntax = "proto3";

package erutan;

option java_multiple_files = true;
option java_package = "com.erutan";
option java_outer_classname = "Erutan";
option csharp_namespace = "Erutan.Scripts.Protos";
import "google/protobuf/timestamp.proto";

/*
    The Erutan service.
    Allows you to actually play the game.
*/
service Erutan {
    /*
    Blabla
    */
    rpc Stream(stream Packet) returns (stream Packet) {}
}

message Metadata {
    google.protobuf.Timestamp timestamp = 1;
}


message NetVector3 {
    double x = 1;
    double y = 2;
    double z = 3;
}

message NetQuaternion {
    double x = 1;
    double y = 2;
    double z = 3;
    double w = 4;
}

// TODO: parent ...
message NetObject {
    string object_id = 1;
    string owner_id = 2;
    NetVector3 position = 3;
    NetQuaternion rotation = 4;
    NetVector3 scale = 5;
    Type type = 6;
    enum Type {
        ANIMAL = 0;
        FOOD = 1;
        GROUND = 2;
    }
    repeated Component components = 7;
}

// Data-oriented design like
message Component {
    oneof type {
        AnimalComponent animal = 1;
        FoodComponent food = 2;
        GroundComponent ground = 3;
    }
    message AnimalComponent {
        double life = 1;
    }
    message FoodComponent {
    }
    message GroundComponent {
    }
}

message Packet {
    Metadata metadata = 1;

    oneof type {
        // General physical objects
        CreateObjectPacket create_object = 2;
        UpdatePositionPacket update_position = 3;
        UpdateRotationPacket update_rotation = 4;
        DestroyObjectPacket destroy_object = 5;

        // Animals & Environment
        FoodEatenPacket food_eaten = 6;
        UpdateAnimalPacket update_animal = 7;

        // Server general parameters

    }

    message CreateObjectPacket {
        NetObject object = 1; 
    }

    message UpdatePositionPacket {
        string object_id = 1;
        NetVector3 position = 2;
    }

    message UpdateRotationPacket {
        string object_id = 1;
        NetQuaternion rotation = 2;
    }

    message DestroyObjectPacket {
        string object_id = 1;
    }

    // Occurs when an animal hit a food -> gain life, food disappear ...
    message FoodEatenPacket { // Idk about this packet, maybe for eating animations ...
        string food_id = 1; // I guess will be useful in the future with several foods
        NetObject eater = 2;
    }

    message UpdateAnimalPacket { // Maybe will have more params later
        string object_id = 1;
        double life = 2;
    }

    message UpdateParametersPacket {
        repeated Parameter parameters = 1;
        message Parameter {
            oneof type {
                TickrateParameter tickrate_parameter = 1;
            }
            message TickrateParameter {
                double tick_rate = 1;
            }
        }
    }
}
